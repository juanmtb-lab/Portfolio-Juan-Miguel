<script>
    const modal = document.getElementById('contactModal');
    const contactForm = document.getElementById('contactForm');

    // Función para abrir/cerrar modal
    function toggleModal() {
        if (modal) {
            modal.classList.toggle('active');
            document.body.classList.toggle('modal-open');
        }
    }

    // Cerrar modal al hacer clic fuera
    window.onclick = function(event) {
        if (event.target == modal) toggleModal();
    }

    // Escuchar el envío del formulario
    if (contactForm) {
        contactForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Seleccionamos el botón de forma segura
            const submitBtn = document.getElementById('submitBtn') || e.target.querySelector('button[type="submit"]');
            const originalBtnText = submitBtn.innerText;
            
            try {
                // Bloquear botón para evitar múltiples envíos
                submitBtn.innerText = "Enviando...";
                submitBtn.disabled = true;

                const formData = {
                    nombre: document.getElementById('name').value,
                    contacto: document.getElementById('contactInfo').value,
                    asunto: document.getElementById('subject').value,
                    mensaje: document.getElementById('message').value,
                    enviado_desde: "Portfolio Web",
                    fecha: new Date().toLocaleString()
                };

                // URL corregida con codificación para espacios
                const webhookURL = "https://n8n-n8n.qgofek.easypanel.host/webhook/Contacto%20Portfolio";

                const response = await fetch(webhookURL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    alert("¡Mensaje enviado con éxito!");
                    contactForm.reset();
                    toggleModal();
                } else {
                    throw new Error("Respuesta fallida del servidor");
                }

            } catch (error) {
                console.error("Error al enviar:", error);
                alert("Hubo un problema al enviar el mensaje. Por favor, escríbeme a juanmtb9@gmail.com");
            } finally {
                // Restaurar botón siempre
                submitBtn.innerText = originalBtnText;
                submitBtn.disabled = false;
            }
        });
    }
</script>




